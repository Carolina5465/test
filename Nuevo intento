@When("^Extraigo el nombre del ultimo XML en ruta \"([^\"]+)\" y lo guardo en la variable \"([^\"]+)\"$")
public void extraigoNombreDelUltimoXML(String carpetaXml, String varName) throws Exception {
    // 1) Validar ruta
    Path dir = Paths.get(carpetaXml);
    if (!Files.isDirectory(dir)) {
        throw new Exception("[XML] Ruta no valida: " + dir.toAbsolutePath());
    }

    // 2) Tomar el XML más reciente (por lastModified)
    Path ultimoXml = Files.list(dir)
            .filter(p -> p.getFileName().toString().toLowerCase().endsWith(".xml"))
            .max(Comparator.comparingLong(p -> {
                try { return Files.getLastModifiedTime(p).toMillis(); }
                catch (Exception e) { return 0L; }
            }))
            .orElseThrow(() -> new Exception("[XML] No se encontro XML en: " + dir.toAbsolutePath()));

    String fileName = ultimoXml.getFileName().toString(); // -> con extensión (.xml)
    System.out.println(String.format("[XML] Más reciente: %s | fecha=%s",
            fileName, Files.getLastModifiedTime(ultimoXml)));

    // 3) Guardar como en tus otros pasos:
    //    3.a) En GlobalContext (para leer luego con GlobalContext.get(varName))
    GlobalContext.set(varName, fileName);

    //    3.b) En StepResult (para leer luego con getScenarioContext().getLastStepResultVariable())
    StepResult sr = new StepResult();
    sr.setFieldValue(varName, fileName);
    getScenarioContext().saveLastStepResult(sr, varName);

    // Log de confirmación (mismo estilo de tus métodos)
    System.out.println("[OK] Guardado @" + varName + " = " + fileName);
}
